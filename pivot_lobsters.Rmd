---
title: "Pivot Lobsters"
author: "James"
date: "1/27/2020"
output: html_document
---

Attaching our packages and reading in data


```{r}
library(tidyverse)
library(readxl)
library(here)
library(skimr) # install.packages ("skimr")
library(kableExtra) # install.packages("kableExtra")

# read in lobster data
lobsters <- read_xlsx(here("data/lobsters.xlsx"),
                      skip = 4)

```

Viewing our data with skimr
```{r}
# these are equivalent
skimr::skim(lobsters) # explicitly stated from skimr
skim(lobsters) # not explicit
```

# %>% <- pipe operator reads "and then" (one of the reasons tidyverse and diplyr -"dee ply are") are so awesome

# Pivot Tables

In R, Pivot tables are: `group_by() %>% summarize()`
 # shortcut for pipe reader (cmd shft m), the "n" function will count observations 

```{r}
# group by year
lobsters %>% 
  group_by(year) %>%  
  summarize(count_by_year = n())

#group by year and site
lobsters %>% 
  group_by(year, site) %>%  
  summarize(count_by_year_site = n())

#group by site and year
lobsters %>% 
  group_by(site, year) %>%  
  summarize(count_by_site_year = n())

```

Summarize by multiple variables

```{r}
lobsters %>% 
  group_by(site, year) %>% 
  summarize(count_by_site_year = n (),
            mean_size_mm = mean(size_mm))
```

# have R calculate the N/As with what's given, "na rm" = remove the N/As

```{r}
lobsters %>% 
  group_by(site, year) %>% 
  summarize(count_by_site_year = n (),
            mean_size_mm = mean(size_mm, na.rm = TRUE))
```

# adding std deviation, and assign as an object

```{r}
siteyear_summary <- lobsters %>%  
  group_by(site, year) %>% 
  summarize(count_by_site_year = n (),
            mean_size_mm = mean(size_mm, na.rm = TRUE),
            sd_size_mm = sd(size_mm, na.rm = TRUE))  # need to add the na.rm again
```

Table formatting with `kableExtra::kable()`  # what are the `s for??


```{r}
siteyear_summary %>% 
  kable()
```


There are `r nrow(lobsters)` total lobsters included in this report. # if you put the r before, it will let r studio know that you want to run when you knit. 


## Activity 
1. Build from our analysis and calculate the median lobster size for each site and year (hint: `size_mm` variable and a function called `median()`)
2. build a ggplot
3. sync to github

```
ggplot(data = siteyear_summary, aes(x = year, y = median_size_mm, color = site) +
 geom_line()
 ggsave(here("figures". "lobsters-plot.png"))
```


```{r}
siteyear_summary <- lobsters %>%  
  group_by(site, year) %>% 
  summarize(count_by_site_year = n (),
            mean_size_mm = mean(size_mm, na.rm = TRUE),
            sd_size_mm = sd(size_mm, na.rm = TRUE),
            median_size_mm = median(size_mm, na.rm = TRUE)
                                              )
ggplot(data = siteyear_summary, aes(x = year, y = median_size_mm, color = site)) +
 geom_line() + 
 ggsave(here("figures", "lobsters-plot.png"))
```















